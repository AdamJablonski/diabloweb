{"version":3,"sources":["fs.js","api/game.worker.js","../node_modules/peerjs/dist sync","serviceWorker.js","api/sound.js","api/load_spawn.js","api/webrtc.js","api/loader.js","App.js","index.js"],"names":["importStorage","Promise","resolve","reject","done","frame","document","createElement","window","addEventListener","_ref","data","method","files","contentWindow","postMessage","src","style","display","body","appendChild","setTimeout","downloadFile","_callee","store","name","file","blob","url","lnk","C_Work_diabloweb_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default","a","wrap","_context","prev","next","get","toLowerCase","sent","Blob","type","URL","createObjectURL","setAttribute","click","removeChild","revokeObjectURL","console","error","concat","stop","downloadSaves","_callee2","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_context2","undefined","keys","t0","Symbol","iterator","value","match","t1","return","finish","readFile","reader","FileReader","onload","result","onerror","onabort","readAsArrayBuffer","uploadFile","_callee3","_context3","Uint8Array","set","abrupt","create_fs","_x7","_create_fs","apply","this","arguments","_callee4","load","_i","_Object$entries","_ref7","_ref3","_name","_data","_files","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_ref6","_ref5","_context4","IdbKvStore","Map","Object","json","entries","call","length","C_Work_diabloweb_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","t2","DownloadFile","DownloadSaves","update","delete","remove","clear","download","upload","t3","module","exports","Worker","__webpack_require__","p","webpackEmptyContext","req","e","Error","code","id","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","log","onUpdate","onSuccess","catch","init_sound","AudioContext","webkitAudioContext","StereoPannerNode","webkitAudioPannerNode","create_sound","duplicate_sound","play_sound","set_volume","stop_sound","delete_sound","context","sounds","create_sound_raw","channels","rate","buffer","createBuffer","i","getChannelData","subarray","gain","createGain","panner","pan","decodeAudioData","srcId","volume","loop","source","Math","pow","relVolume","createBufferSource","node","connect","destination","start","stop_all","sound","slicedToArray","err","SpawnSizes","load_spawn","_x","_x2","_load_spawn","api","fs","spawn","regenerator_default","includes","byteLength","axios","request","process","responseType","onDownloadProgress","onProgress","text","loaded","total","headers","Cache-Control","slice","buffer_reader","classCallCheck","pos","read8","String","fromCharCode","toConsumableArray","buffer_writer","write8","charCodeAt","RejectionReason","JOIN_SUCCESS","JOIN_ALREADY_IN_GAME","JOIN_GAME_NOT_FOUND","JOIN_INCORRECT_PASSWORD","JOIN_VERSION_MISMATCH","JOIN_GAME_FULL","CREATE_GAME_EXISTS","server_join_accept_packet","read","cookie","read32","index","seed","difficulty","write","write32","server_join_reject_packet","reason","server_connect_packet","_ref8","server_disconnect_packet","_ref9","server_message_packet","payload","rest","_ref10","server_turn_packet","turn","_ref11","client_info_packet","version","_ref12","client_create_game_packet","read_str","password","_ref13","write_str","client_join_game_packet","_ref14","client_leave_game_packet","client_drop_player_packet","_ref15","client_message_packet","_ref16","client_turn_packet","_ref17","PeerID","webrtc_server","_ref18","onMessage","onClose","_this","peer","Peer","on","conn","onConnect","players","myplr","floor","random","onError","off","onOpen","_this2","packet","pkt","send","handle","drop","mask","destroy","close","webrtc_client","_ref19","_this3","pending","unreg","clearTimeout","timeout","push","webrtc_open","server","client","onRender","ctx","bitmap","images","clip","belt","transferFromImageBitmap","x","y","w","h","image","createImageData","putImageData","save","font","x0","y0","x1","y1","beginPath","rect","_ref4","str","color","r","g","b","fillStyle","fillText","restore","updateBelt","audio","mpq","offscreen","canvas","getContext","alpha","worker","packetQueue","webrtc","action","func","_len","params","Array","_key","batch","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","setCursorPos","openKeyboard","stack","onExit","setCurrentSave","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","transfer","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","setInterval","load_game","do_load_game","reportLink","retail","message","searchParams","split","map","line","join","userAgent","toString","ReactGA","initialize","pageview","TOUCH_MOVE","TOUCH_RMB","Link","children","props","objectWithoutProperties","react_default","assign","target","rel","App","possibleConstructorReturn","getPrototypeOf","started","loading","dropping","has_spawn","cursorPos","touchControls","touchButtons","touchCtx","touchMods","touchBelt","onDrop","dataTransfer","items","kind","getAsFile","getDropFile","preventDefault","setState","onDragEnter","setDropping","onDragOver","isDropFile","onDragLeave","downloadSave","saveName","stopPropagation","onResize","exitPointerLock","onPointerLockChange","screen","innerHeight","height","pointerLocked","game","onMouseMove","_this$mousePos","mousePos","eventMods","onMouseDown","keyboard","element","classList","_this$mousePos2","requestPointerLock","mouseButton","onMouseUp","_this$mousePos3","onKeyDown","keyCode","key","showKeyboard","clearKeySel","onMenu","onKeyUp","onKeyboard","valid","substring","values","_","parseFile","touchButton","touchCanvas","onTouchStart","updateTouchButton","touches","_this$mousePos4","onTouchMove","_this$mousePos5","onTouchEnd","prevTc","_this$mousePos6","setTouchButton","fullscreenElement","requestFullscreen","setCanvas","setElement","setKeyboard","setTouch0","setTouch_","bind","assertThisInitialized","setTouch1","setTouch2","setTouch3","setTouchBelt_","setTouch4","setTouch5","inc","_ref2","max","left","toFixed","top","width","add","focus","blur","_this4","getBoundingClientRect","right","bottom","progress","reload","idx","slot","drawImage","used","Set","has","drawBelt","_this5","removeEventListener","event","category","passive","capture","pointerLockElement","mozPointerLockElement","min","movementX","movementY","clientX","clientY","round","button","shiftKey","ctrlKey","altKey","len","setSelectionRange","use","toggle","now","performance","beltTime","release","_this6","touchOther","btn","_loop","identifier","stick","find","t","panPos","v","indexOf","original","_ret","setTouchMod","dx","dy","step","offsetHeight","abs","_this7","_this$state","className","classNames","touch","ref","active","onChange","spellCheck","App_Link","href","onClick","htmlFor","accept","React","Component","ReactDOM","render","src_App_0","getElementById","origin","fetch","response","contentType","status","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.3717595d.chunk.js","sourcesContent":["import IdbKvStore from  'idb-kv-store';\r\n\r\nconst importStorage = () => new Promise((resolve, reject) => {\r\n  let done = false;\r\n  const frame = document.createElement('iframe');\r\n  window.addEventListener('message', ({data}) => {\r\n    if (data.method === 'storage' && !done) {\r\n      done = true;\r\n      resolve(data.files);\r\n      frame.contentWindow.postMessage({method: 'clear'}, '*');\r\n    }\r\n  });\r\n  frame.addEventListener('load', () => {\r\n    frame.contentWindow.postMessage({method: 'transfer'}, '*');\r\n  });\r\n  frame.addEventListener('error', () => {\r\n    if (!done) {\r\n      done = true;\r\n      resolve(null);\r\n    }\r\n  });\r\n  frame.src = \"https://diablo.rivsoft.net/storage.html\";\r\n  frame.style.display = \"none\";\r\n  document.body.appendChild(frame);\r\n  setTimeout(() => {\r\n    if (!done) {\r\n      done = true;\r\n      resolve(null);\r\n    }\r\n  }, 10000);\r\n});\r\n\r\nasync function downloadFile(store, name) {\r\n  const file = await store.get(name.toLowerCase());\r\n  if (file) {\r\n    const blob = new Blob([file], {type: 'binary/octet-stream'});\r\n    const url = URL.createObjectURL(blob);\r\n    const lnk = document.createElement('a');\r\n    lnk.setAttribute('href', url);\r\n    lnk.setAttribute('download', name);\r\n    document.body.appendChild(lnk);\r\n    lnk.click();\r\n    document.body.removeChild(lnk);\r\n    URL.revokeObjectURL(url);\r\n  } else {\r\n    console.error(`File ${name} does not exist`);\r\n  }\r\n}\r\n\r\nasync function downloadSaves(store) {\r\n  for (let name of await store.keys()) {\r\n    if (name.match(/\\.sv$/i)) {\r\n      downloadFile(store, name);\r\n    }\r\n  }\r\n}\r\n\r\nconst readFile = file => new Promise((resolve, reject) => {\r\n  const reader = new FileReader();\r\n  reader.onload = () => resolve(reader.result);\r\n  reader.onerror = () => reject(reader.error);\r\n  reader.onabort = () => reject();\r\n  reader.readAsArrayBuffer(file);\r\n});\r\nasync function uploadFile(store, files, file) {\r\n  const data = new Uint8Array(await readFile(file));\r\n  files.set(file.name.toLowerCase(), data);\r\n  return store.set(file.name.toLowerCase(), data);\r\n}\r\n\r\nexport default async function create_fs(load) {\r\n  try {\r\n    const store = new IdbKvStore('diablo_fs');\r\n    const files = new Map();\r\n    for (let [name, data] of Object.entries(await store.json())) {\r\n      files.set(name, data);\r\n    }\r\n    if (load) {\r\n      const files = await importStorage();\r\n      if (files) {\r\n        for (let [name, data] of files) {\r\n          files.set(name, data);\r\n          store.set(name, data);\r\n        }\r\n      }\r\n    }\r\n    window.DownloadFile = name => downloadFile(store, name);\r\n    window.DownloadSaves = () => downloadSaves(store);\r\n    return {\r\n      files,\r\n      update: (name, data) => store.set(name, data),\r\n      delete: name => store.remove(name),\r\n      clear: () => store.clear(),\r\n      download: name => downloadFile(store, name),\r\n      upload: file => uploadFile(store, files, file),\r\n    };\r\n  } catch (e) {\r\n    window.DownloadFile = () => console.error('IndexedDB is not supported');\r\n    window.DownloadSaves = () => console.error('IndexedDB is not supported');\r\n    return {\r\n      files: new Map(),\r\n      update: () => Promise.resolve(),\r\n      delete: () => Promise.resolve(),\r\n      clear: () => Promise.resolve(),\r\n      download: () => Promise.resolve(),\r\n      upload: () => Promise.resolve(),\r\n    };\r\n  }  \r\n}\r\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"35f22eb14a4817ef6e49.worker.js\");\n};","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 62;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","function no_sound() {\r\n  return {\r\n    create_sound: () => 0,\r\n    duplicate_sound: () => 0,\r\n    play_sound: () => undefined,\r\n    set_volume: () => undefined,\r\n    stop_sound: () => undefined,\r\n    delete_sound: () => undefined,\r\n  };\r\n}\r\n\r\nfunction decodeAudioData(context, buffer) {\r\n  return new Promise((resolve, reject) => {\r\n    context.decodeAudioData(buffer, resolve, reject);\r\n  });\r\n}\r\n\r\nexport default function init_sound() {\r\n  const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n  const StereoPannerNode = window.StereoPannerNode || window.webkitAudioPannerNode;\r\n  if (!AudioContext) {\r\n    return no_sound();\r\n  }\r\n\r\n  let context = null;\r\n  try {\r\n    context = new AudioContext();\r\n  } catch (e) {\r\n  }\r\n  const sounds = new Map();\r\n\r\n  return {\r\n    create_sound_raw(id, data, length, channels, rate) {\r\n      if (!context) {\r\n        return;\r\n      }\r\n      const buffer = context.createBuffer(channels, length, rate);\r\n      for (let i = 0; i < channels; ++i) {\r\n        buffer.getChannelData(i).set(data.subarray(i * length, i * length + length));\r\n      }\r\n      sounds.set(id, {\r\n        buffer: Promise.resolve(buffer),\r\n        gain: context.createGain(),\r\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    create_sound(id, data) {\r\n      if (!context) {\r\n        return;\r\n      }\r\n      const buffer = decodeAudioData(context, data.buffer);\r\n      sounds.set(id, {\r\n        buffer,\r\n        gain: context.createGain(),\r\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    duplicate_sound(id, srcId) {\r\n      if (!context) {\r\n        return;\r\n      }\r\n      const src = sounds.get(srcId);\r\n      if (!src) {\r\n        return;\r\n      }\r\n      sounds.set(id, {\r\n        buffer: src.buffer,\r\n        gain: context.createGain(),\r\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    play_sound(id, volume, pan, loop) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        if (src.source) {\r\n          src.source.then(source => source.stop());\r\n        }\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n        const relVolume = Math.pow(2.0, pan / 1000.0);\r\n        if (src.panner) {\r\n          src.panner.pan.value = 1.0 - 2.0 / (1.0 + relVolume);\r\n        }\r\n        src.source = src.buffer.then(buffer => {\r\n          const source = context.createBufferSource();\r\n          source.buffer = buffer;\r\n          source.loop = !!loop;\r\n          let node = source.connect(src.gain);\r\n          if (src.panner) {\r\n            node = node.connect(src.panner);\r\n          }\r\n          node.connect(context.destination);\r\n          source.start();\r\n          return source;\r\n        });\r\n      }\r\n    },\r\n    set_volume(id, volume) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n      }\r\n    },\r\n    stop_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.then(source => source.stop());\r\n        delete src.source;\r\n      }\r\n    },\r\n    delete_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.then(source => source.stop());\r\n      }\r\n      sounds.delete(id);\r\n    },\r\n\r\n    stop_all() {\r\n      for (let [, sound] of sounds) {\r\n        if (sound.source) {\r\n          sound.source.then(source => source.stop());\r\n        }\r\n      }\r\n      sounds.clear();\r\n      context = null;\r\n    }\r\n  };\r\n}\r\n","import axios from 'axios';\r\n\r\nconst SpawnSizes = [50274091, 25830791];\r\n\r\nexport { SpawnSizes };\r\n\r\nexport default async function load_spawn(api, fs) {\r\n  let file = fs.files.get('spawn.mpq');\r\n  if (file && !SpawnSizes.includes(file.byteLength)) {\r\n    fs.files.delete('spawn.mpq');\r\n    await fs.delete('spawn.mpq');\r\n    file = null;\r\n  }\r\n  if (!file) {\r\n    const spawn = await axios.request({\r\n      url: process.env.PUBLIC_URL + '/spawn.mpq',\r\n      responseType: 'arraybuffer',\r\n      onDownloadProgress: e => {\r\n        if (api.onProgress) {\r\n          api.onProgress({text: 'Downloading...', loaded: e.loaded, total: e.total || SpawnSizes[1]});\r\n        }\r\n      },\r\n      headers: {\r\n        'Cache-Control': 'max-age=31536000'\r\n      }\r\n    });\r\n    if (!SpawnSizes.includes(spawn.data.byteLength)) {\r\n      throw Error(\"Invalid spawn.mpq size. Try clearing cache and refreshing the page.\");\r\n    }\r\n    const data = new Uint8Array(spawn.data);\r\n    fs.files.set('spawn.mpq', data);\r\n    fs.update('spawn.mpq', data.slice());\r\n  }\r\n  return fs;\r\n}\r\n","import Peer from 'peerjs';\r\n\r\nclass buffer_reader {\r\n  constructor(buffer) {\r\n    this.buffer = (buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer));\r\n    this.pos = 0;\r\n  }\r\n  done() {\r\n    return this.pos === this.buffer.byteLength;\r\n  }\r\n  read8() {\r\n    if (this.pos >= this.buffer.byteLength) {\r\n      throw Error('packet too small');\r\n    }\r\n    return this.buffer[this.pos++];\r\n  }\r\n  read16() {\r\n    const {pos, buffer} = this;\r\n    if (pos + 2 > buffer.byteLength) {\r\n      throw Error('packet too small');\r\n    }\r\n    const result = buffer[pos] | (buffer[pos + 1] << 8);\r\n    this.pos += 2;\r\n    return result;\r\n  }\r\n  read32() {\r\n    const {pos, buffer} = this;\r\n    if (pos + 4 > buffer.byteLength) {\r\n      throw Error('packet too small');\r\n    }\r\n    const result = buffer[pos] | (buffer[pos + 1] << 8) | (buffer[pos + 2] << 16) | (buffer[pos + 3] << 24);\r\n    this.pos += 4;\r\n    return result;\r\n  }\r\n  read_str() {\r\n    const length = this.read8();\r\n    const {pos, buffer} = this;\r\n    if (pos + length > buffer.byteLength) {\r\n      throw Error('packet too small');\r\n    }\r\n    const result = String.fromCharCode(...buffer.subarray(pos, pos + length));\r\n    this.pos += length;\r\n    return result;\r\n  }\r\n  rest() {\r\n    const result = this.buffer.subarray(this.pos);\r\n    this.pos = this.buffer.length;\r\n    return result;\r\n  }\r\n}\r\nclass buffer_writer {\r\n  constructor(length) {\r\n    this.buffer = new Uint8Array(length);\r\n    this.pos = 0;\r\n  }\r\n  get result() {\r\n    return this.buffer.buffer;\r\n  }\r\n  write8(value) {\r\n    this.buffer[this.pos++] = value;\r\n    return this;\r\n  }\r\n  write16(value) {\r\n    const {pos, buffer} = this;\r\n    buffer[pos] = value;\r\n    buffer[pos + 1] = value >> 8;\r\n    this.pos += 2;\r\n    return this;\r\n  }\r\n  write32(value) {\r\n    const {pos, buffer} = this;\r\n    buffer[pos] = value;\r\n    buffer[pos + 1] = value >> 8;\r\n    buffer[pos + 2] = value >> 16;\r\n    buffer[pos + 3] = value >> 24;\r\n    this.pos += 4;\r\n    return this;\r\n  }\r\n  write_str(value) {\r\n    const length = value.length;\r\n    this.write8(length);\r\n    const {pos, buffer} = this;\r\n    for (let i = 0; i < length; ++i) {\r\n      buffer[pos + i] = value.charCodeAt(i);\r\n    }\r\n    this.pos += length;\r\n    return this;\r\n  }\r\n  rest(value) {\r\n    this.buffer.set(value, this.pos);\r\n    return this;\r\n  }\r\n}\r\n\r\nconst RejectionReason = {\r\n  JOIN_SUCCESS: 0x00,\r\n  JOIN_ALREADY_IN_GAME: 0x01,\r\n  JOIN_GAME_NOT_FOUND: 0x02,\r\n  JOIN_INCORRECT_PASSWORD: 0x03,\r\n  JOIN_VERSION_MISMATCH: 0x04,\r\n  JOIN_GAME_FULL: 0x05,\r\n  CREATE_GAME_EXISTS: 0x06,\r\n};\r\n\r\nconst server_info_packet = {\r\n  code: 0x32,\r\n  read: reader => ({version: reader.read32()}),\r\n  write: ({version}) => new buffer_writer(5).write8(server_info_packet.code).write32(version).result,\r\n};\r\nconst server_game_list_packet = {\r\n  code: 0x21,\r\n  read: reader => {\r\n    const count = reader.read8();\r\n    const games = [];\r\n    for (let i = 0; i < count; ++i) {\r\n      games.push({type: reader.read32(), name: reader.read_str()});\r\n    }\r\n    return {games};\r\n  },\r\n  write: ({games}) => {\r\n    const writer = new buffer_writer(games.reduce((sum, {name}) => sum + 5 + name.length, 2));\r\n    writer.write8(server_game_list_packet.code);\r\n    writer.write8(games.length);\r\n    for (let {code, name} of games) {\r\n      writer.write32(code);\r\n      writer.write_str(name);\r\n    }\r\n    return writer.result;\r\n  },\r\n};\r\nconst server_join_accept_packet = {\r\n  code: 0x12,\r\n  read: reader => ({cookie: reader.read32(), index: reader.read8(), seed: reader.read32(), difficulty: reader.read32()}),\r\n  write: ({cookie, index, seed, difficulty}) => new buffer_writer(14).write8(server_join_accept_packet.code).write32(cookie).write8(index).write32(seed).write32(difficulty).result,\r\n};\r\nconst server_join_reject_packet = {\r\n  code: 0x15,\r\n  read: reader => ({cookie: reader.read32(), reason: reader.read8()}),\r\n  write: ({cookie, reason}) => new buffer_writer(6).write8(server_join_reject_packet.code).write32(cookie).write8(reason).result,\r\n};\r\nconst server_connect_packet = {\r\n  code: 0x13,\r\n  read: reader => ({id: reader.read8()}),\r\n  write: ({id}) => new buffer_writer(2).write8(server_connect_packet.code).write8(id).result,\r\n};\r\nconst server_disconnect_packet = {\r\n  code: 0x14,\r\n  read: reader => ({id: reader.read8(), reason: reader.read32()}),\r\n  write: ({id, reason}) => new buffer_writer(6).write8(server_disconnect_packet.code).write8(id).write32(reason).result,\r\n};\r\nconst server_message_packet = {\r\n  code: 0x01,\r\n  read: reader => ({id: reader.read8(), payload: reader.rest()}),\r\n  write: ({id, payload}) => new buffer_writer(2 + payload.byteLength).write8(server_message_packet.code).write8(id).rest(payload).result,\r\n};\r\nconst server_turn_packet = {\r\n  code: 0x02,\r\n  read: reader => ({id: reader.read8(), turn: reader.read32()}),\r\n  write: ({id, turn}) => new buffer_writer(6).write8(server_turn_packet.code).write8(id).write32(turn).result,\r\n};\r\n\r\nconst client_info_packet = {\r\n  code: 0x31,\r\n  read: reader => ({version: reader.read32()}),\r\n  write: ({version}) => new buffer_writer(5).write8(client_info_packet.code).write32(version).result,\r\n};\r\nconst client_game_list_packet = {\r\n  code: 0x21,\r\n  read: () => ({}),\r\n  write: () => new buffer_writer(1).write8(client_game_list_packet.code).result,\r\n};\r\nconst client_create_game_packet = {\r\n  code: 0x22,\r\n  read: reader => ({cookie: reader.read32(), name: reader.read_str(), password: reader.read_str(), difficulty: reader.read32()}),\r\n  write: ({cookie, name, password, difficulty}) => new buffer_writer(11 + name.length + password.length)\r\n    .write8(client_create_game_packet.code).write32(cookie).write_str(name).write_str(password).write32(difficulty).result,\r\n};\r\nconst client_join_game_packet = {\r\n  code: 0x23,\r\n  read: reader => ({cookie: reader.read32(), name: reader.read_str(), password: reader.read_str()}),\r\n  write: ({cookie, name, password}) => new buffer_writer(7 + name.length + password.length)\r\n    .write8(client_join_game_packet.code).write32(cookie).write_str(name).write_str(password).result,\r\n};\r\nconst client_leave_game_packet = {\r\n  code: 0x24,\r\n  read: () => ({}),\r\n  write: () => new buffer_writer(1).write8(client_leave_game_packet.code).result,\r\n};\r\nconst client_drop_player_packet = {\r\n  code: 0x03,\r\n  read: reader => ({id: reader.read8(), reason: reader.read32()}),\r\n  write: ({id, reason}) => new buffer_writer(6).write8(client_drop_player_packet.code).write8(id).write32(reason).result,\r\n};\r\nconst client_message_packet = {\r\n  code: 0x01,\r\n  read: reader => ({id: reader.read8(), payload: reader.rest()}),\r\n  write: ({id, payload}) => new buffer_writer(2 + payload.byteLength).write8(client_message_packet.code).write8(id).rest(payload).result,\r\n};\r\nconst client_turn_packet = {\r\n  code: 0x02,\r\n  read: reader => ({turn: reader.read32()}),\r\n  write: ({turn}) => new buffer_writer(5).write8(client_turn_packet.code).write32(turn).result,\r\n};\r\n\r\nconst PeerID = name => `diabloweb_${name}`;\r\nconst MAX_PLRS = 4;\r\n\r\nclass webrtc_server {\r\n  constructor(version, {cookie, name, password, difficulty}, onMessage, onClose) {\r\n    this.version = version;\r\n    this.name = name;\r\n    this.password = password;\r\n    this.difficulty = difficulty;\r\n    this.onMessage = onMessage;\r\n    this.onClose = onClose;\r\n\r\n    this.peer = new Peer(PeerID(name));\r\n    this.peer.on('connection', conn => this.onConnect(conn));\r\n    this.players = [];\r\n    this.myplr = 0;\r\n\r\n    this.seed = Math.floor(Math.random() * Math.pow(2, 32));\r\n\r\n    const onError = () => {\r\n      onMessage(server_join_reject_packet.write({cookie, reason: RejectionReason.CREATE_GAME_EXISTS}));\r\n      onClose();\r\n      this.peer.off('error', onError);\r\n      this.peer.off('open', onOpen);\r\n    };\r\n    const onOpen = () => {\r\n      onMessage(server_join_accept_packet.write({cookie, index: 0, seed: this.seed, difficulty}));\r\n      onMessage(server_connect_packet.write({id: 0}));\r\n      this.peer.off('error', onError);\r\n      this.peer.off('open', onOpen);\r\n    };\r\n    this.peer.on('error', onError);\r\n    this.peer.on('open', onOpen);\r\n  }\r\n\r\n  onConnect(conn) {\r\n    const peer = {conn};\r\n    conn.on('data', packet => {\r\n      const reader = new buffer_reader(packet);\r\n      const code = reader.read8();\r\n      let pkt;\r\n      switch (code) {\r\n      case client_info_packet.code:\r\n        pkt = client_info_packet.read(reader);\r\n        peer.version = pkt.version;\r\n        break;\r\n      case client_join_game_packet.code:\r\n        pkt = client_join_game_packet.read(reader);\r\n        if (peer.version !== this.version) {\r\n          conn.send(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_VERSION_MISMATCH}));\r\n        } else if (pkt.name !== this.name) {\r\n          conn.send(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_GAME_NOT_FOUND}));\r\n        } else if (pkt.password !== this.password) {\r\n          conn.send(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_INCORRECT_PASSWORD}));\r\n        } else {\r\n          let i = 1;\r\n          while (i < MAX_PLRS && this.players[i]) {\r\n            ++i;\r\n          }\r\n          if (i >= MAX_PLRS) {\r\n            conn.send(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_GAME_FULL}));            \r\n          } else {\r\n            this.players[i] = peer;\r\n            peer.id = i;\r\n            conn.send(server_join_accept_packet.write({cookie: pkt.cookie, index: i, seed: this.seed, difficulty: this.difficulty}));\r\n            this.send(0xFF, server_connect_packet.write({id: i}));\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        if (peer.id != null) {\r\n          this.handle(peer.id, code, reader);\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      if (!reader.done()) {\r\n        throw Error('packet too large');\r\n      }\r\n    });\r\n    conn.on('close', () => {\r\n      if (peer.id != null) {\r\n        this.drop(peer.id, 0x40000006);\r\n      }\r\n    });\r\n  }\r\n\r\n  send(mask, pkt) {\r\n    for (let i = 1; i < MAX_PLRS; ++i) {\r\n      if ((mask & (1 << i)) && this.players[i]) {\r\n        if (this.players[i].conn) {\r\n          this.players[i].conn.send(pkt);\r\n        }\r\n      }\r\n    }\r\n    // self last since it will destroy the buffer\r\n    if (mask & 1) {\r\n      this.onMessage(pkt);\r\n    }\r\n  }\r\n\r\n  drop(id, reason) {\r\n    if (id === 0) {\r\n      for (let i = 1; i < MAX_PLRS; ++i) {\r\n        this.drop(i, 0x40000006);\r\n      }\r\n      this.onMessage(server_disconnect_packet.write({id, reason}));\r\n      this.peer.destroy();\r\n      this.onClose();\r\n    } else if (this.players[id]) {\r\n      this.send(0xFF, server_disconnect_packet.write({id, reason}));\r\n      this.players[id].id = null;\r\n      if (this.players[id].conn) {\r\n        this.players[id].conn.close();\r\n      }\r\n      this.players[id] = null;\r\n    }\r\n  }\r\n\r\n  handle(id, code, reader) {\r\n    let pkt;\r\n    switch (code) {\r\n    case client_leave_game_packet.code:\r\n      pkt = client_leave_game_packet.read(reader);\r\n      this.drop(id, 3);\r\n      break;\r\n    case client_drop_player_packet.code:\r\n      pkt = client_drop_player_packet.read(reader);\r\n      this.drop(pkt.id, pkt.reason);\r\n      break;\r\n    case client_message_packet.code:\r\n      pkt = client_message_packet.read(reader);\r\n      this.send(pkt.id === 0xFF ? ~(1 << id) : (1 << pkt.id), server_message_packet.write({id, payload: pkt.payload}));\r\n      break;\r\n    case client_turn_packet.code:\r\n      pkt = client_turn_packet.read(reader);\r\n      this.send(~(1 << id), server_turn_packet.write({id, turn: pkt.turn}));\r\n      break;\r\n    default:\r\n      throw Error(`invalid packet ${code}`);\r\n    }\r\n  }\r\n}\r\n\r\nclass webrtc_client {\r\n  pending = [];\r\n\r\n  constructor(version, {cookie, name, password}, onMessage, onClose) {\r\n    this.peer = new Peer();\r\n    this.conn = this.peer.connect(PeerID(name));\r\n\r\n    const unreg = () => {\r\n      this.peer.off('error', onError);\r\n      this.conn.off('error', onError);\r\n      this.conn.off('open', onOpen);\r\n      clearTimeout(timeout);\r\n    };\r\n    const onError = () => {\r\n      onMessage(server_join_reject_packet.write({cookie, reason: RejectionReason.JOIN_GAME_NOT_FOUND}));\r\n      onClose();\r\n      unreg();\r\n    };\r\n    const onOpen = () => {\r\n      unreg();\r\n      this.conn.send(client_info_packet.write({version}));\r\n      this.conn.send(client_join_game_packet.write({cookie, name, password}));\r\n      for (let pkt of this.pending) {\r\n        this.conn.send(pkt);\r\n      }\r\n      this.pending = null;\r\n    };\r\n    const timeout = setTimeout(onError, 5000);\r\n    this.peer.on('error', onError);\r\n    this.conn.on('error', onError);\r\n    this.conn.on('open', onOpen);\r\n\r\n    this.conn.on('data', data => {\r\n      const reader = new buffer_reader(data);\r\n      const code = reader.read8();\r\n      let pkt;\r\n      switch (code) {\r\n      case server_join_accept_packet.code:\r\n        pkt = server_join_accept_packet.read(reader);\r\n        this.myplr = pkt.index;\r\n        break;\r\n      case server_join_reject_packet.code:\r\n        onClose();\r\n        break;\r\n      case server_disconnect_packet.code:\r\n        pkt = server_disconnect_packet.read(reader);\r\n        if (pkt.id === 'myplr') {\r\n          onClose();\r\n        }\r\n        break;\r\n      default:\r\n      }\r\n      onMessage(data);\r\n    });\r\n    this.conn.on('close', data => {\r\n      onClose();\r\n    });\r\n  }\r\n\r\n  send(packet) {\r\n    if (this.pending) {\r\n      this.pending.push(packet);\r\n    } else {\r\n      this.conn.send(packet);\r\n    }\r\n  }\r\n}\r\n\r\nexport default function webrtc_open(onMessage) {\r\n  let server = null, client = null;\r\n\r\n  let version = 0;\r\n\r\n  return {\r\n    send: function(packet) {\r\n      const reader = new buffer_reader(packet);\r\n      const code = reader.read8();\r\n      let pkt;\r\n      switch (code) {\r\n      case client_info_packet.code:\r\n        pkt = client_info_packet.read(reader);\r\n        version = pkt.version;\r\n        break;\r\n      case client_create_game_packet.code:\r\n        pkt = client_create_game_packet.read(reader);\r\n        if (server || client) {\r\n          onMessage(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_ALREADY_IN_GAME}));\r\n        } else {\r\n          server = new webrtc_server(version, pkt, onMessage, () => server = null);\r\n        }\r\n        break;\r\n      case client_join_game_packet.code:\r\n        pkt = client_join_game_packet.read(reader);\r\n        if (server || client) {\r\n          onMessage(server_join_reject_packet.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_ALREADY_IN_GAME}));\r\n        } else {\r\n          client = new webrtc_client(version, pkt, onMessage, () => client = null);\r\n        }\r\n        break;\r\n      default:\r\n        if (server) {\r\n          server.handle(0, code, reader);\r\n          if (pkt === client_leave_game_packet.code) {\r\n            server = null;\r\n          }\r\n        } else if (client) {\r\n          client.send(packet);\r\n          if (pkt === client_leave_game_packet.code) {\r\n            client = null;\r\n          }\r\n          return;\r\n        } else {\r\n          throw Error(`invalid packet ${code}`);\r\n        }\r\n      }\r\n      if (!reader.done()) {\r\n        throw Error('packet too large');\r\n      }\r\n    },\r\n  };\r\n}\r\n","import Worker from './game.worker.js';\r\nimport init_sound from './sound';\r\nimport load_spawn from './load_spawn';\r\nimport webrtc_open from './webrtc';\r\n\r\nfunction onRender(api, ctx, {bitmap, images, text, clip, belt}) {\r\n  if (bitmap) {\r\n    ctx.transferFromImageBitmap(bitmap);\r\n  } else {\r\n    for (let {x, y, w, h, data} of images) {\r\n      const image = ctx.createImageData(w, h);\r\n      image.data.set(data);\r\n      ctx.putImageData(image, x, y);\r\n    }\r\n    if (text.length) {\r\n      ctx.save();\r\n      ctx.font = 'bold 13px Times New Roman';\r\n      if (clip) {\r\n        const {x0, y0, x1, y1} = clip;\r\n        ctx.beginPath();\r\n        ctx.rect(x0, y0, x1 - x0, y1 - y0);\r\n        ctx.clip();\r\n      }\r\n      for (let {x, y, text: str, color} of text) {\r\n        const r = ((color >> 16) & 0xFF);\r\n        const g = ((color >> 8) & 0xFF);\r\n        const b = (color & 0xFF);\r\n        ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;\r\n        ctx.fillText(str, x, y + 22);\r\n      }\r\n      ctx.restore();\r\n    }\r\n  }\r\n\r\n  api.updateBelt(belt);\r\n}\r\n\r\nfunction testOffscreen() {\r\n  return false;\r\n  // This works but I couldn't see any performance difference, and support for 2D canvas in workers is very poor.\r\n  // In this mode, instead of sending a batch of areas to draw back to the main thread, the worker does all drawing on its own and sends a complete bitmap object back.\r\n  // However, this effectively clears the worker's canvas, so we need to redraw the whole frame every time, which defeats the performance gained from reduced copying.\r\n  /*try {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const offscreen = canvas.transferControlToOffscreen();\r\n    const context = offscreen.getContext(\"2d\");\r\n    return context != null;\r\n  } catch (e) {\r\n    return false;\r\n  }*/\r\n}\r\n\r\nasync function do_load_game(api, audio, mpq, spawn) {\r\n  const fs = await api.fs;\r\n  if (spawn && !mpq) {\r\n    await load_spawn(api, fs);\r\n  }\r\n\r\n  let context = null, offscreen = false;\r\n  if (testOffscreen()) {\r\n    context = api.canvas.getContext(\"bitmaprenderer\");\r\n    offscreen = true;\r\n  } else {\r\n    context = api.canvas.getContext(\"2d\", {alpha: false});\r\n  }\r\n  return await new Promise((resolve, reject) => {\r\n    try {\r\n      const worker = new Worker();\r\n\r\n      let packetQueue = [];\r\n      const webrtc = webrtc_open(data => {\r\n        packetQueue.push(data);\r\n      });\r\n\r\n      worker.addEventListener(\"message\", ({data}) => {\r\n        switch (data.action) {\r\n        case \"loaded\":\r\n          resolve((func, ...params) => worker.postMessage({action: \"event\", func, params}));\r\n          break;\r\n        case \"render\":\r\n          onRender(api, context, data.batch);\r\n          break;\r\n        case \"audio\":\r\n          audio[data.func](...data.params);\r\n          break;\r\n        case \"audioBatch\":\r\n          for (let {func, params} of data.batch) {\r\n            audio[func](...params);\r\n          }\r\n          break;\r\n        case \"fs\":\r\n          fs[data.func](...data.params);\r\n          break;\r\n        case \"cursor\":\r\n          api.setCursorPos(data.x, data.y);\r\n          break;\r\n        case \"keyboard\":\r\n          api.openKeyboard(data.rect);\r\n          break;\r\n        case \"error\":\r\n          audio.stop_all();\r\n          api.onError(data.error, data.stack);\r\n          break;\r\n        case \"failed\":\r\n          reject(Error(data.stack || data.error));\r\n          break;\r\n        case \"progress\":\r\n          api.onProgress({text: data.text, loaded: data.loaded, total: data.total});\r\n          break;\r\n        case \"exit\":\r\n          api.onExit();\r\n          break;\r\n        case \"current_save\":\r\n          api.setCurrentSave(data.name);\r\n          break;\r\n          case \"packet\":\r\n          webrtc.send(data.buffer);\r\n          break;\r\n        case \"packetBatch\":\r\n          for (let packet of data.batch) {\r\n            webrtc.send(packet);\r\n          }\r\n          break;\r\n        default:\r\n        }\r\n      });          \r\n      const transfer= [];\r\n      for (let [, file] of fs.files) {\r\n        transfer.push(file.buffer);\r\n      }\r\n      worker.postMessage({action: \"init\", files: fs.files, mpq, spawn, offscreen}, transfer);\r\n      setInterval(() => {\r\n        if (packetQueue.length) {\r\n          worker.postMessage({action: \"packetBatch\", batch: packetQueue}, packetQueue);\r\n          packetQueue.length = 0;\r\n        }\r\n      }, 20);\r\n      delete fs.files;\r\n    } catch (e) {\r\n      reject(e);\r\n    }\r\n  });\r\n}\r\n\r\nexport default function load_game(api, mpq, spawn) {\r\n  const audio = init_sound();\r\n  return do_load_game(api, audio, mpq, spawn);\r\n}\r\n","import React from 'react';\r\nimport './App.scss';\r\nimport classNames from 'classnames';\r\nimport ReactGA from 'react-ga';\r\n\r\nimport create_fs from './fs';\r\nimport load_game from './api/loader';\r\nimport { SpawnSizes } from './api/load_spawn';\r\n\r\nimport Peer from 'peerjs';\r\n\r\nwindow.Peer = Peer;\r\n\r\nif (process.env.NODE_ENV === 'production') {\r\n  ReactGA.initialize('UA-43123589-6');\r\n  ReactGA.pageview('/');\r\n}\r\n\r\nfunction reportLink(e, retail) {\r\n  const message = e.stack || e.message || \"Unknown error\";\r\n  const url = new URL(\"https://github.com/d07RiV/diabloweb/issues/new\");\r\n  url.searchParams.set(\"body\",\r\n`**Description:**\r\n[Please describe what you were doing before the error occurred]\r\n\r\n**App version:**\r\nDiabloWeb ${process.env.VERSION} (${retail ? 'Retail' : 'Shareware'})\r\n\r\n**Error message:**\r\n    \r\n${message.split(\"\\n\").map(line => \"    \" + line).join(\"\\n\")}\r\n\r\n**User agent:**\r\n\r\n    ${navigator.userAgent}\r\n\r\n**Save file:**\r\n[Please attach the save file, if applicable. The error box should have a link to download the current save you were playing; alternatively, you can open dev console on the game page (F12) and type in ${\"`DownloadSaves()`\"}]\r\n`);\r\n  return url.toString();\r\n}\r\n\r\nfunction isDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return true;\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\nfunction getDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return e.dataTransfer.items[i].getAsFile();\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return e.dataTransfer.files[0];\r\n  }\r\n}\r\n\r\nconst TOUCH_MOVE = 0;\r\nconst TOUCH_RMB = 1;\r\nconst TOUCH_SHIFT = 2;\r\n\r\nconst Link = ({children, ...props}) => <a target=\"_blank\" rel=\"noopener noreferrer\" {...props}>{children}</a>;\r\n\r\nclass App extends React.Component {\r\n  files = new Map();\r\n  state = {started: false, loading: false, dropping: 0, has_spawn: false};\r\n  cursorPos = {x: 0, y: 0};\r\n\r\n  touchControls = false;\r\n  touchButtons = [null, null, null, null, null, null];\r\n  touchCtx = [null, null, null, null, null, null];\r\n  touchMods = [false, false, false, false, false, false];\r\n  touchBelt = [-1, -1, -1, -1, -1, -1];\r\n\r\n  fs = create_fs(true);\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.setTouch0 = this.setTouch_.bind(this, 0);\r\n    this.setTouch1 = this.setTouch_.bind(this, 1);\r\n    this.setTouch2 = this.setTouch_.bind(this, 2);\r\n    this.setTouch3 = this.setTouchBelt_.bind(this, 3);\r\n    this.setTouch4 = this.setTouchBelt_.bind(this, 4);\r\n    this.setTouch5 = this.setTouchBelt_.bind(this, 5);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"drop\", this.onDrop, true);\r\n    document.addEventListener(\"dragover\", this.onDragOver, true);\r\n    document.addEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.addEventListener(\"dragleave\", this.onDragLeave, true);\r\n\r\n    this.fs.then(fs => {\r\n      const spawn = fs.files.get('spawn.mpq');\r\n      if (spawn && SpawnSizes.includes(spawn.byteLength)) {\r\n        this.setState({has_spawn: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  onDrop = e => {\r\n    const file = getDropFile(e);\r\n    if (file) {\r\n      e.preventDefault();\r\n      this.start(file);\r\n    }\r\n    this.setState({dropping: 0});\r\n  }\r\n  onDragEnter = e => {\r\n    e.preventDefault();\r\n    this.setDropping(1);\r\n  }\r\n  onDragOver = e => {\r\n    if (isDropFile(e)) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n  onDragLeave = e => {\r\n    this.setDropping(-1);\r\n  }\r\n  setDropping(inc) {\r\n    this.setState(({dropping}) => ({dropping: Math.max(dropping + inc, 0)}));\r\n  }\r\n\r\n  onError(message, stack) {\r\n    this.setState(({error}) => !error && {error: {message, stack}});\r\n  }\r\n\r\n  openKeyboard(rect) {\r\n    if (rect) {\r\n      this.showKeyboard = {\r\n        left: `${(100 * (rect[0] - 10) / 640).toFixed(2)}%`,\r\n        top: `${(100 * (rect[1] - 10) / 480).toFixed(2)}%`,\r\n        width: `${(100 * (rect[2] - rect[0] + 20) / 640).toFixed(2)}%`,\r\n        height: `${(100 * (rect[3] - rect[1] + 20) / 640).toFixed(2)}%`,\r\n      };\r\n      this.element.classList.add(\"keyboard\");\r\n      Object.assign(this.keyboard.style, this.showKeyboard);\r\n      this.keyboard.focus();\r\n    } else {\r\n      this.showKeyboard = false;\r\n      this.element.classList.remove(\"keyboard\");\r\n      this.keyboard.blur();\r\n      this.keyboard.value = \"\";\r\n    }\r\n  }\r\n\r\n  setCursorPos(x, y) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    this.cursorPos = {\r\n      x: rect.left + (rect.right - rect.left) * x / 640,\r\n      y: rect.top + (rect.bottom - rect.top) * y / 480,\r\n    };\r\n    setTimeout(() => {\r\n      this.game(\"DApi_Mouse\", 0, 0, 0, x, y);\r\n    });\r\n  }\r\n\r\n  onProgress(progress) {\r\n    this.setState({progress});\r\n  }\r\n\r\n  onExit() {\r\n    if (!this.state.error) {\r\n      window.location.reload();\r\n    }\r\n  }\r\n\r\n  setCurrentSave(name) {\r\n    this.saveName = name;\r\n  }\r\n  downloadSave = e => {\r\n    this.fs.then(fs => this.saveName && fs.download(this.saveName));\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n\r\n  drawBelt(idx, slot) {\r\n    if (!this.canvas) return;\r\n    if (!this.touchButtons[idx]) {\r\n      return;\r\n    }\r\n    this.touchBelt[idx] = slot;\r\n    if (slot >= 0) {\r\n      this.touchButtons[idx].style.display = \"block\";\r\n      this.touchCtx[idx].drawImage(this.canvas, 205 + 29 * slot, 357, 28, 28, 0, 0, 28, 28);\r\n    } else {\r\n      this.touchButtons[idx].style.display = \"none\";\r\n    }\r\n  }\r\n\r\n  updateBelt(belt) {\r\n    if (belt) {\r\n      const used = new Set();\r\n      let pos = 3;\r\n      for (let i = 0; i < belt.length && pos < 6; ++i) {\r\n        if (belt[i] >= 0 && !used.has(belt[i])) {\r\n          this.drawBelt(pos++, i);\r\n          used.add(belt[i]);\r\n        }\r\n      }\r\n      for (; pos < 6; ++pos) {\r\n        this.drawBelt(pos, -1);\r\n      }\r\n    } else {\r\n      this.drawBelt(3, -1);\r\n      this.drawBelt(4, -1);\r\n      this.drawBelt(5, -1);\r\n    }\r\n  }\r\n\r\n  start(file) {\r\n    if (file && file.name.match(/\\.sv$/i)) {\r\n      this.fs.then(fs => fs.upload(file)).then(console.log(`Updated ${file.name}`));\r\n      return;\r\n    }\r\n\r\n    document.removeEventListener(\"drop\", this.onDrop, true);\r\n    document.removeEventListener(\"dragover\", this.onDragOver, true);\r\n    document.removeEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.removeEventListener(\"dragleave\", this.onDragLeave, true);\r\n    this.setState({dropping: 0});\r\n\r\n    const retail = !!(file && file.name.match(/^diabdat\\.mpq$/i));\r\n    if (process.env.NODE_ENV === 'production') {\r\n      ReactGA.event({\r\n        category: 'Game',\r\n        action: retail ? 'Start Retail' : 'Start Shareware',\r\n      });\r\n    }\r\n\r\n    this.setState({loading: true, retail});\r\n\r\n    load_game(this, file, !retail).then(game => {\r\n      this.game = game;\r\n\r\n      document.addEventListener('mousemove', this.onMouseMove, true);\r\n      document.addEventListener('mousedown', this.onMouseDown, true);\r\n      document.addEventListener('mouseup', this.onMouseUp, true);\r\n      document.addEventListener('keydown', this.onKeyDown, true);\r\n      document.addEventListener('keyup', this.onKeyUp, true);\r\n      document.addEventListener('contextmenu', this.onMenu, true);\r\n\r\n      document.addEventListener('touchstart', this.onTouchStart, {passive: false, capture: true});\r\n      document.addEventListener('touchmove', this.onTouchMove, {passive: false, capture: true});\r\n      document.addEventListener('touchend', this.onTouchEnd, {passive: false, capture: true});\r\n\r\n      document.addEventListener('pointerlockchange', this.onPointerLockChange);\r\n      window.addEventListener('resize', this.onResize);\r\n\r\n      this.setState({started: true});\r\n    }, e => this.onError(e.message, e.stack));\r\n  }\r\n\r\n  pointerLocked() {\r\n    return document.pointerLockElement === this.canvas || document.mozPointerLockElement === this.canvas;\r\n  }\r\n\r\n  mousePos(e) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    if (this.pointerLocked()) {\r\n      this.cursorPos.x = Math.max(rect.left, Math.min(rect.right, this.cursorPos.x + e.movementX));\r\n      this.cursorPos.y = Math.max(rect.top, Math.min(rect.bottom, this.cursorPos.y + e.movementY));\r\n    } else {\r\n      this.cursorPos = {x: e.clientX, y: e.clientY};\r\n    }\r\n    return {\r\n      x: Math.max(0, Math.min(Math.round((this.cursorPos.x - rect.left) / (rect.right - rect.left) * 640), 639)),\r\n      y: Math.max(0, Math.min(Math.round((this.cursorPos.y - rect.top) / (rect.bottom - rect.top) * 480), 479)),\r\n    };\r\n  }\r\n\r\n  mouseButton(e) {\r\n    switch (e.button) {\r\n    case 0: return 1;\r\n    case 1: return 4;\r\n    case 2: return 2;\r\n    case 3: return 5;\r\n    case 4: return 6;\r\n    default: return 1;\r\n    }\r\n  }\r\n  eventMods(e) {\r\n    return ((e.shiftKey || this.touchMods[TOUCH_SHIFT]) ? 1 : 0) + (e.ctrlKey ? 2 : 0) + (e.altKey ? 4 : 0) + (e.touches ? 8 : 0);\r\n  }\r\n\r\n  onResize = () => {\r\n    document.exitPointerLock();\r\n  }\r\n\r\n  onPointerLockChange = () => {\r\n    if (window.screen && window.innerHeight === window.screen.height && !this.pointerLocked()) {\r\n      // assume that the user pressed escape\r\n      this.game(\"DApi_Key\", 0, 0, 27);\r\n      this.game(\"DApi_Key\", 1, 0, 27);\r\n    }\r\n  }\r\n\r\n  onMouseMove = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseDown = e => {\r\n    if (!this.canvas) return;\r\n    if (e.target === this.keyboard) {\r\n      return;\r\n    }\r\n    if (this.touchControls) {\r\n      this.touchControls = false;\r\n      this.element.classList.remove(\"touch\");\r\n    }\r\n    const {x, y} = this.mousePos(e);\r\n    if (window.screen && window.innerHeight === window.screen.height) {\r\n      // we're in fullscreen, let's get pointer lock!\r\n      if (!this.pointerLocked()) {\r\n        this.canvas.requestPointerLock();\r\n      }\r\n    }\r\n    this.game(\"DApi_Mouse\", 1, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseUp = e => {\r\n    if (!this.canvas) return;\r\n    if (e.target === this.keyboard) {\r\n      return;\r\n    }\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 2, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyDown = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 0, this.eventMods(e), e.keyCode);\r\n    if (e.keyCode >= 32 && e.key.length === 1 && !this.showKeyboard) {\r\n      this.game(\"DApi_Char\", e.key.charCodeAt(0));\r\n    }\r\n    this.clearKeySel();\r\n    if (!this.showKeyboard) {\r\n      if (e.keyCode === 8 || (e.keyCode >= 112 && e.keyCode <= 119)) {\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  }\r\n\r\n  onMenu = e => {\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyUp = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 1, this.eventMods(e), e.keyCode);\r\n    this.clearKeySel();\r\n  }\r\n\r\n  clearKeySel() {\r\n    if (this.showKeyboard) {\r\n      const len = this.keyboard.value.length;\r\n      this.keyboard.setSelectionRange(len, len);\r\n    }\r\n  }\r\n\r\n  onKeyboard = () => {\r\n    if (this.showKeyboard) {\r\n      const text = this.keyboard.value;\r\n      const valid = (text.match(/[\\x20-\\x7E]/g) || []).join(\"\").substring(0, 15);\r\n      if (text !== valid) {\r\n        this.keyboard.value = valid;\r\n      }\r\n      this.clearKeySel();\r\n      const values = [...Array(15)].map((_, i) => i < valid.length ? valid.charCodeAt(i) : 0);\r\n      this.game(\"DApi_SyncText\", ...values);\r\n    }\r\n  }\r\n\r\n  parseFile = e => {\r\n    const files = e.target.files;\r\n    if (files.length > 0) {\r\n      this.start(files[0]);\r\n    }\r\n  }\r\n\r\n  touchButton = null;\r\n  touchCanvas = null;\r\n\r\n  setTouchMod(index, value, use) {\r\n    if (index < 3) {\r\n      this.touchMods[index] = value;\r\n      if (this.touchButtons[index]) {\r\n        this.touchButtons[index].classList.toggle(\"active\", value);\r\n      }\r\n    } else if (use && this.touchBelt[index] >= 0) {\r\n      const now = performance.now();\r\n      if (!this.beltTime || now - this.beltTime > 750) {\r\n        this.game(\"DApi_Char\", 49 + this.touchBelt[index]);\r\n        this.beltTime = now;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateTouchButton(touches, release) {\r\n    let touchOther = null;\r\n    if (!this.touchControls) {\r\n      this.touchControls = true;\r\n      this.element.classList.add(\"touch\");\r\n    }\r\n    const btn = this.touchButton;\r\n    for (let {target, identifier, clientX, clientY} of touches) {\r\n      if (btn && btn.id === identifier && this.touchButtons[btn.index] === target) {\r\n        if (touches.length > 1) {\r\n          btn.stick = false;\r\n        }\r\n        btn.clientX = clientX;\r\n        btn.clientY = clientY;\r\n        this.touchCanvas = [...touches].find(t => t.identifier !== identifier);\r\n        if (this.touchCanvas) {\r\n          this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n        }\r\n        delete this.panPos;\r\n        return this.touchCanvas != null;\r\n      }\r\n      const idx = this.touchButtons.indexOf(target);\r\n      if (idx >= 0 && !touchOther) {\r\n        touchOther = {id: identifier, index: idx, stick: true, original: this.touchMods[idx], clientX, clientY};\r\n      }\r\n    }\r\n    if (btn && !touchOther && release && btn.stick) {\r\n      const rect = this.touchButtons[btn.index].getBoundingClientRect();\r\n      const {clientX, clientY} = btn;\r\n      if (clientX >= rect.left && clientX < rect.right && clientY >= rect.top && clientY < rect.bottom) {\r\n        this.setTouchMod(btn.index, !btn.original, true);\r\n      } else {\r\n        this.setTouchMod(btn.index, btn.original);\r\n      }\r\n    } else if (btn) {\r\n      this.setTouchMod(btn.index, false);\r\n    }\r\n    this.touchButton = touchOther;\r\n    if (touchOther) {\r\n      this.setTouchMod(touchOther.index, true);\r\n      if (touchOther.index === TOUCH_MOVE) {\r\n        this.setTouchMod(TOUCH_RMB, false);\r\n      } else if (touchOther.index === TOUCH_RMB) {\r\n        this.setTouchMod(TOUCH_MOVE, false);\r\n      }\r\n      delete this.panPos;\r\n    } else if (touches.length === 2) {\r\n      const x = (touches[1].clientX + touches[0].clientX) / 2, y = (touches[1].clientY + touches[0].clientY) / 2;\r\n      if (this.panPos) {\r\n        const dx = x - this.panPos.x, dy = y - this.panPos.y;\r\n        const step = this.canvas.offsetHeight / 12;\r\n        if (Math.max(Math.abs(dx), Math.abs(dy)) > step) {\r\n          let key;\r\n          if (Math.abs(dx) > Math.abs(dy)) {\r\n            key = (dx > 0 ? 0x25 : 0x27);\r\n          } else {\r\n            key = (dy > 0 ? 0x26 : 0x28);\r\n          }\r\n          this.game(\"DApi_Key\", 0, 0, key);\r\n          // key up is ignored anyway\r\n          this.panPos = {x, y};\r\n        }\r\n      } else {\r\n        this.game(\"DApi_Mouse\", 0, 0, 24, 320, 180);\r\n        this.game(\"DApi_Mouse\", 2, 1, 24, 320, 180);\r\n        this.panPos = {x, y};\r\n      }\r\n      this.touchCanvas = null;\r\n      return false;\r\n    } else {\r\n      delete this.panPos;\r\n    }\r\n    this.touchCanvas = [...touches].find(t => !touchOther || t.identifier !== touchOther.id);\r\n    if (this.touchCanvas) {\r\n      this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n    }\r\n    return this.touchCanvas != null;\r\n  }\r\n\r\n  onTouchStart = e => {\r\n    if (!this.canvas) return;\r\n    if (e.target === this.keyboard) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n      if (!this.touchMods[TOUCH_MOVE]) {\r\n        this.game(\"DApi_Mouse\", 1, this.touchMods[TOUCH_RMB] ? 2 : 1, this.eventMods(e), x, y);\r\n      }\r\n    }\r\n  }\r\n  onTouchMove = e => {\r\n    if (!this.canvas) return;\r\n    if (e.target === this.keyboard) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    }\r\n  }\r\n  onTouchEnd = e => {\r\n    if (!this.canvas) return;\r\n    if (e.target === this.keyboard) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    const prevTc = this.touchCanvas;\r\n    this.updateTouchButton(e.touches, true);\r\n    if (prevTc && !this.touchCanvas) {\r\n      const {x, y} = this.mousePos(prevTc);\r\n      this.game(\"DApi_Mouse\", 2, 1, this.eventMods(e), x, y);\r\n      this.game(\"DApi_Mouse\", 2, 2, this.eventMods(e), x, y);\r\n\r\n      if (this.touchMods[TOUCH_RMB] && (!this.touchButton || this.touchButton.index !== TOUCH_RMB)) {\r\n        this.setTouchButton(TOUCH_RMB, false);\r\n      }\r\n    }\r\n    if (!document.fullscreenElement) {\r\n      this.element.requestFullscreen();\r\n    }\r\n  }\r\n\r\n  setCanvas = e => this.canvas = e;\r\n  setElement = e => this.element = e;\r\n  setKeyboard = e => this.keyboard = e;\r\n  setTouch_(i, e) {\r\n    this.touchButtons[i] = e;\r\n  }\r\n  setTouchBelt_(i, e) {\r\n    this.touchButtons[i] = e;\r\n    if (e) {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = 28;\r\n      canvas.height = 28;\r\n      e.appendChild(canvas);\r\n      this.touchCtx[i] = canvas.getContext(\"2d\");\r\n    } else {\r\n      this.touchCtx[i] = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {started, loading, error, progress, dropping, has_spawn} = this.state;\r\n    return (\r\n      <div className={classNames(\"App\", {touch: this.touchControls, started, dropping, keyboard: !!this.showKeyboard})} ref={this.setElement}>\r\n        <div className=\"touch-ui touch-mods\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\", {active: this.touchMods[0]})} ref={this.setTouch0}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\", {active: this.touchMods[1]})} ref={this.setTouch1}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\", {active: this.touchMods[2]})} ref={this.setTouch2}/>\r\n        </div>\r\n        <div className=\"touch-ui touch-belt\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\")} ref={this.setTouch3}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\")} ref={this.setTouch4}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\")} ref={this.setTouch5}/>\r\n        </div>\r\n        <div className=\"Body\">\r\n          <div className=\"inner\">\r\n            {!error && <canvas ref={this.setCanvas} width={640} height={480}/>}\r\n            <input type=\"text\" className=\"keyboard\" onChange={this.onKeyboard} ref={this.setKeyboard} spellCheck={false} style={this.showKeyboard || {}}/>\r\n          </div>\r\n        </div>\r\n        <div className=\"BodyV\">\r\n          {!!error && (\r\n            <Link className=\"error\" href={reportLink(error, this.state.retail)}>\r\n              <p className=\"header\">The following error has occurred:</p>\r\n              <p className=\"body\">{error.message}</p>\r\n              <p className=\"footer\">Click to create an issue on GitHub</p>\r\n              {this.saveName != null && <p className=\"link\" onClick={this.downloadSave}>Download save file</p>}\r\n            </Link>\r\n          )}\r\n          {!!loading && !started && !error && (\r\n            <div className=\"loading\">\r\n              {(progress && progress.text) || 'Loading...'}\r\n              {progress != null && !!progress.total && (\r\n                <span className=\"progressBar\"><span><span style={{width: `${Math.round(100 * progress.loaded / progress.total)}%`}}/></span></span>\r\n              )}\r\n            </div>\r\n          )}\r\n          {!started && !loading && !error && (\r\n            <div className=\"start\">\r\n              <p>\r\n                This is a web port of the original Diablo game, based on source code reconstructed by\r\n                GalaXyHaXz and devilution team. The project page with information and links can be found over here <Link href=\"https://github.com/d07RiV/diabloweb\">https://github.com/d07RiV/diabloweb</Link>\r\n              </p>\r\n              <p>\r\n                If you own the original game, you can drop the original DIABDAT.MPQ onto this page or click the button below to start playing.\r\n                The game can be purchased from <Link href=\"https://www.gog.com/game/diablo\">GoG</Link>.\r\n              </p>\r\n              {!has_spawn && (\r\n                <p>\r\n                  Or you can play the shareware version for free (50MB download).\r\n                </p>\r\n              )}\r\n              <form>\r\n                <label htmlFor=\"loadFile\" className=\"startButton\">Select MPQ</label>\r\n                <input accept=\".mpq\" type=\"file\" id=\"loadFile\" style={{display: \"none\"}} onChange={this.parseFile}/>\r\n              </form>\r\n              <span className=\"startButton\" onClick={() => this.start()}>Play Shareware</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './reset.css';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport App from './App';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\nserviceWorker.register();\r\n"],"sourceRoot":""}