{"version":3,"sources":["api/game.worker.js","serviceWorker.js","api/load_spawn.js","api/loader.js","api/sound.js","App.js","index.js","fs.js"],"names":["module","exports","Worker","__webpack_require__","p","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","SpawnSize","load_spawn","_x","_x2","_load_spawn","apply","this","arguments","_callee","api","fs","file","spawn","data","regenerator_default","a","wrap","_context","prev","next","files","get","byteLength","delete","axios","request","url","responseType","onDownloadProgress","e","onProgress","text","loaded","total","headers","Cache-Control","sent","Error","Uint8Array","set","update","slice","abrupt","stop","onRender","ctx","_ref","bitmap","images","clip","belt","transferFromImageBitmap","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","_ref5","value","x","y","w","h","image","createImageData","putImageData","err","return","length","save","font","x0","y0","x1","y1","beginPath","rect","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_ref4","str","color","r","g","b","fillStyle","concat","fillText","restore","updateBelt","audio","mpq","context","offscreen","name","canvas","getContext","alpha","Promise","resolve","reject","worker","addEventListener","_ref6","action","func","_len","params","Array","_key","postMessage","batch","Object","toConsumableArray","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_ref8","setCursorPos","openKeyboard","open","onError","transfer","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_ref11","_ref10","slicedToArray","push","buffer","load_game","do_load_game","AudioContext","webkitAudioContext","create_sound","duplicate_sound","play_sound","set_volume","stop_sound","delete_sound","sounds","Map","id","channels","rate","createBuffer","i","copyToChannel","subarray","gain","createGain","panner","StereoPannerNode","pan","srcId","src","volume","loop","source","Math","pow","relVolume","createBufferSource","connect","destination","start","init_sound","TOUCH_MOVE","TOUCH_RMB","Link","children","props","objectWithoutProperties","react_default","createElement","assign","target","rel","App","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","started","loading","touch","dropping","has_spawn","cursorPos","touchButtons","touchCtx","touchMods","touchBelt","create_fs","assertThisInitialized","onDrop","dataTransfer","items","kind","getAsFile","getDropFile","preventDefault","setState","onDragEnter","setDropping","onDragOver","isDropFile","onDragLeave","onResize","document","exitPointerLock","onPointerLockChange","screen","innerHeight","height","pointerLocked","game","onMouseMove","_this$mousePos","mousePos","eventMods","onMouseDown","_this$mousePos2","requestPointerLock","mouseButton","onMouseUp","_this$mousePos3","onKeyDown","keyCode","key","charCodeAt","onMenu","onKeyUp","_this2","keyboard","values","map","_","parseFile","touchButton","touchCanvas","onFullscreenChange","fullscreenElement","element","onTouchStart","updateTouchButton","touches","_this$mousePos4","onTouchMove","_this$mousePos5","onTouchEnd","prevTc","_this$mousePos6","index","setTouchButton","requestFullscreen","setCanvas","setElement","setKeyboard","setTouch0","setTouch_","bind","setTouch1","setTouch2","setTouch3","setTouchBelt_","setTouch4","setTouch5","_this3","inc","_ref2","max","focus","blur","_this4","getBoundingClientRect","left","right","top","bottom","setTimeout","progress","idx","slot","style","display","drawImage","used","Set","pos","has","drawBelt","add","_this5","removeEventListener","passive","capture","message","pointerLockElement","mozPointerLockElement","min","movementX","movementY","clientX","clientY","round","button","shiftKey","ctrlKey","altKey","use","classList","toggle","now","performance","beltTime","release","_this6","touchOther","btn","_loop","_ref3","identifier","stick","find","t","panPos","v","indexOf","original","_ret","setTouchMod","dx","dy","step","offsetHeight","abs","width","appendChild","_this7","_this$state","className","classNames","ref","active","type","App_Link","href","htmlFor","accept","onChange","onClick","React","Component","ReactDOM","render","src_App_0","getElementById","URL","process","origin","fetch","response","contentType","status","ready","unregister","reload","checkValidServiceWorker","_create_fs","store","_i","_Object$entries","C_Work_diabloweb_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","IdbKvStore","t0","json","t1","entries","C_Work_diabloweb_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","remove","t2"],"mappings":"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","file":"static/js/main.f708879f.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"4edcc7263513f350b03e.worker.js\");\n};","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import axios from 'axios';\r\n\r\nconst SpawnSize = 50274091;\r\n\r\nexport { SpawnSize };\r\n\r\nexport default async function load_spawn(api, fs) {\r\n  let file = fs.files.get('spawn.mpq');\r\n  if (file && file.byteLength !== SpawnSize) {\r\n    fs.files.delete('spawn.mpq');\r\n    await fs.delete('spawn.mpq');\r\n    file = null;\r\n  }\r\n  if (!file) {\r\n    const spawn = await axios.request({\r\n      url: '/spawn.mpq',\r\n      responseType: 'arraybuffer',\r\n      onDownloadProgress: e => {\r\n        if (api.onProgress) {\r\n          api.onProgress({text: 'Downloading...', loaded: e.loaded, total: e.total || SpawnSize});\r\n        }\r\n      },\r\n      headers: {\r\n        'Cache-Control': 'max-age=31536000'\r\n      }\r\n    });\r\n    if (spawn.data.byteLength !== SpawnSize) {\r\n      throw Error(\"Invalid spawn.mpq size. Try clearing cache and refreshing the page.\");\r\n    }\r\n    const data = new Uint8Array(spawn.data);\r\n    fs.files.set('spawn.mpq', data);\r\n    fs.update('spawn.mpq', data.slice());\r\n  }\r\n  return fs;\r\n}\r\n","import Worker from './game.worker.js';\r\nimport init_sound from './sound';\r\nimport load_spawn from './load_spawn';\r\n\r\nfunction onRender(api, ctx, {bitmap, images, text, clip, belt}) {\r\n  if (bitmap) {\r\n    ctx.transferFromImageBitmap(bitmap);\r\n  } else {\r\n    for (let {x, y, w, h, data} of images) {\r\n      const image = ctx.createImageData(w, h);\r\n      image.data.set(data);\r\n      ctx.putImageData(image, x, y);\r\n    }\r\n    if (text.length) {\r\n      ctx.save();\r\n      ctx.font = 'bold 13px Times New Roman';\r\n      if (clip) {\r\n        const {x0, y0, x1, y1} = clip;\r\n        ctx.beginPath();\r\n        ctx.rect(x0, y0, x1 - x0, y1 - y0);\r\n        ctx.clip();\r\n      }\r\n      for (let {x, y, text: str, color} of text) {\r\n        const r = ((color >> 16) & 0xFF);\r\n        const g = ((color >> 8) & 0xFF);\r\n        const b = (color & 0xFF);\r\n        ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;\r\n        ctx.fillText(str, x, y + 22);\r\n      }\r\n      ctx.restore();\r\n    }\r\n  }\r\n\r\n  api.updateBelt(belt);\r\n}\r\n\r\nfunction testOffscreen() {\r\n  return false;\r\n  try {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const offscreen = canvas.transferControlToOffscreen();\r\n    const context = offscreen.getContext(\"2d\");\r\n    return context != null;\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function do_load_game(api, audio, mpq) {\r\n  const fs = await api.fs;\r\n  let spawn = true;\r\n  if (mpq) {\r\n    if (!mpq.name.match(/^spawn\\.mpq$/i)) {\r\n      spawn = false;\r\n      fs.files.delete('spawn.mpq');\r\n    }\r\n  } else {\r\n    await load_spawn(api, fs);\r\n  }\r\n\r\n  let context = null, offscreen = false;\r\n  if (testOffscreen()) {\r\n    context = api.canvas.getContext(\"bitmaprenderer\");\r\n    offscreen = true;\r\n  } else {\r\n    context = api.canvas.getContext(\"2d\", {alpha: false});\r\n  }\r\n  return await new Promise((resolve, reject) => {\r\n    try {\r\n      const worker = new Worker();\r\n      worker.addEventListener(\"message\", ({data}) => {\r\n        switch (data.action) {\r\n        case \"loaded\":\r\n          resolve((func, ...params) => worker.postMessage({action: \"event\", func, params}));\r\n          break;\r\n        case \"render\":\r\n          onRender(api, context, data.batch);\r\n          break;\r\n        case \"audio\":\r\n          audio[data.func](...data.params);\r\n          break;\r\n        case \"audioBatch\":\r\n          for (let {func, params} of data.batch) {\r\n            audio[func](...params);\r\n          }\r\n          break;\r\n        case \"fs\":\r\n          fs[data.func](...data.params);\r\n          break;\r\n        case \"cursor\":\r\n          api.setCursorPos(data.x, data.y);\r\n          break;\r\n        case \"keyboard\":\r\n          api.openKeyboard(data.open);\r\n          break;\r\n        case \"error\":\r\n          api.onError(data.error);\r\n          break;\r\n        case \"failed\":\r\n          reject(Error(data.error));\r\n          break;\r\n        case \"progress\":\r\n          api.onProgress({text: data.text, loaded: data.loaded, total: data.total});\r\n          break;\r\n        default:\r\n        }\r\n      });\r\n      const transfer= [];\r\n      for (let [name, file] of fs.files) {\r\n        transfer.push(file.buffer);\r\n      }\r\n      worker.postMessage({action: \"init\", files: fs.files, mpq, spawn, offscreen}, transfer);\r\n      delete fs.files;\r\n    } catch (e) {\r\n      reject(e);\r\n    }\r\n  });\r\n}\r\n\r\nexport default function load_game(api, mpq) {\r\n  const audio = init_sound();\r\n  return do_load_game(api, audio, mpq);\r\n}\r\n","function no_sound() {\r\n  return {\r\n    create_sound: () => 0,\r\n    duplicate_sound: () => 0,\r\n    play_sound: () => undefined,\r\n    set_volume: () => undefined,\r\n    stop_sound: () => undefined,\r\n    delete_sound: () => undefined,\r\n  };\r\n}\r\n\r\nexport default function init_sound() {\r\n  const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n  if (!AudioContext) {\r\n    return no_sound();\r\n  }\r\n\r\n  const context = new AudioContext();\r\n  const sounds = new Map();\r\n\r\n  return {\r\n    create_sound(id, data, length, channels, rate) {\r\n      const buffer = context.createBuffer(channels, length, rate);\r\n      for (let i = 0; i < channels; ++i) {\r\n        buffer.copyToChannel(data.subarray(i * length, i * length + length), i);\r\n      }\r\n      sounds.set(id, {\r\n        buffer,\r\n        gain: context.createGain(),\r\n        panner: new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    duplicate_sound(id, srcId) {\r\n      const src = sounds.get(srcId);\r\n      if (!src) {\r\n        return;\r\n      }\r\n      sounds.set(id, {\r\n        buffer: src.buffer,\r\n        gain: context.createGain(),\r\n        panner: new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    play_sound(id, volume, pan, loop) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        if (src.source) {\r\n          src.source.stop();\r\n        }\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n        const relVolume = Math.pow(2.0, pan / 1000.0);\r\n        src.panner.pan.value = 1.0 - 2.0 / (1.0 + relVolume);\r\n        src.source = context.createBufferSource();\r\n        src.source.buffer = src.buffer;\r\n        src.source.loop = !!loop;\r\n        src.source.connect(src.gain).connect(src.panner).connect(context.destination);\r\n        src.source.start();\r\n      }\r\n    },\r\n    set_volume(id, volume) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n      }\r\n    },\r\n    stop_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.stop();\r\n        delete src.source;\r\n      }\r\n    },\r\n    delete_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.stop();\r\n      }\r\n      sounds.delete(id);\r\n    },\r\n  };\r\n}\r\n","import React from 'react';\r\nimport './App.scss';\r\nimport classNames from 'classnames';\r\n\r\nimport create_fs from './fs';\r\nimport load_game from './api/loader';\r\nimport { SpawnSize } from './api/load_spawn';\r\n\r\nfunction isDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return true;\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\nfunction getDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return e.dataTransfer.items[i].getAsFile();\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return e.dataTransfer.files[0];\r\n  }\r\n}\r\n\r\nconst TOUCH_MOVE = 0;\r\nconst TOUCH_RMB = 1;\r\nconst TOUCH_SHIFT = 2;\r\n\r\nconst Link = ({children, ...props}) => <a target=\"_blank\" rel=\"noopener noreferrer\" {...props}>{children}</a>;\r\n\r\nclass App extends React.Component {\r\n  files = new Map();\r\n  state = {started: false, loading: false, touch: false, dropping: 0, has_spawn: false};\r\n  cursorPos = {x: 0, y: 0};\r\n\r\n  touchButtons = [null, null, null, null, null, null];\r\n  touchCtx = [null, null, null, null, null, null];\r\n  touchMods = [false, false, false, false, false, false];\r\n  touchBelt = [-1, -1, -1, -1, -1, -1];\r\n\r\n  fs = create_fs(this);\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.setTouch0 = this.setTouch_.bind(this, 0);\r\n    this.setTouch1 = this.setTouch_.bind(this, 1);\r\n    this.setTouch2 = this.setTouch_.bind(this, 2);\r\n    this.setTouch3 = this.setTouchBelt_.bind(this, 3);\r\n    this.setTouch4 = this.setTouchBelt_.bind(this, 4);\r\n    this.setTouch5 = this.setTouchBelt_.bind(this, 5);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"drop\", this.onDrop, true);\r\n    document.addEventListener(\"dragover\", this.onDragOver, true);\r\n    document.addEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.addEventListener(\"dragleave\", this.onDragLeave, true);\r\n\r\n    this.fs.then(fs => {\r\n      const spawn = fs.files.get('spawn.mpq');\r\n      if (spawn && spawn.byteLength === SpawnSize) {\r\n        this.setState({has_spawn: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  onDrop = e => {\r\n    const file = getDropFile(e);\r\n    if (file) {\r\n      e.preventDefault();\r\n      this.start(file);\r\n    }\r\n    this.setState({dropping: 0});\r\n  }\r\n  onDragEnter = e => {\r\n    e.preventDefault();\r\n    this.setDropping(1);\r\n  }\r\n  onDragOver = e => {\r\n    if (isDropFile(e)) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n  onDragLeave = e => {\r\n    this.setDropping(-1);\r\n  }\r\n  setDropping(inc) {\r\n    this.setState(({dropping}) => ({dropping: Math.max(dropping + inc, 0)}));\r\n  }\r\n\r\n  onError(text) {\r\n    this.setState({error: text});\r\n  }\r\n\r\n  openKeyboard(open) {\r\n    if (open) {\r\n      this.keyboard.focus();\r\n    } else {\r\n      this.keyboard.blur();\r\n    }\r\n  }\r\n\r\n  setCursorPos(x, y) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    this.cursorPos = {\r\n      x: rect.left + (rect.right - rect.left) * x / 640,\r\n      y: rect.top + (rect.bottom - rect.top) * y / 480,\r\n    };\r\n    setTimeout(() => {\r\n      this.game(\"DApi_Mouse\", 0, 0, 0, x, y);\r\n    });\r\n  }\r\n\r\n  onProgress(progress) {\r\n    this.setState({progress});\r\n  }\r\n\r\n  drawBelt(idx, slot) {\r\n    if (!this.touchButtons[idx]) {\r\n      return;\r\n    }\r\n    this.touchBelt[idx] = slot;\r\n    if (slot >= 0) {\r\n      this.touchButtons[idx].style.display = \"block\";\r\n      this.touchCtx[idx].drawImage(this.canvas, 205 + 29 * slot, 357, 28, 28, 0, 0, 28, 28);\r\n    } else {\r\n      this.touchButtons[idx].style.display = \"none\";\r\n    }\r\n  }\r\n\r\n  updateBelt(belt) {\r\n    if (belt) {\r\n      const used = new Set();\r\n      let pos = 3;\r\n      for (let i = 0; i < belt.length && pos < 6; ++i) {\r\n        if (belt[i] >= 0 && !used.has(belt[i])) {\r\n          this.drawBelt(pos++, i);\r\n          used.add(belt[i]);\r\n        }\r\n      }\r\n      for (; pos < 6; ++pos) {\r\n        this.drawBelt(pos, -1);\r\n      }\r\n    } else {\r\n      this.drawBelt(3, -1);\r\n      this.drawBelt(4, -1);\r\n      this.drawBelt(5, -1);\r\n    }\r\n  }\r\n\r\n  start(file) {\r\n    document.removeEventListener(\"drop\", this.onDrop, true);\r\n    document.removeEventListener(\"dragover\", this.onDragOver, true);\r\n    document.removeEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.removeEventListener(\"dragleave\", this.onDragLeave, true);\r\n    this.setState({dropping: 0});\r\n\r\n    this.setState({loading: true});\r\n\r\n    load_game(this, file).then(game => {\r\n      this.game = game;\r\n\r\n      document.addEventListener('mousemove', this.onMouseMove, true);\r\n      document.addEventListener('mousedown', this.onMouseDown, true);\r\n      document.addEventListener('mouseup', this.onMouseUp, true);\r\n      document.addEventListener('keydown', this.onKeyDown, true);\r\n      document.addEventListener('keyup', this.onKeyUp, true);\r\n      document.addEventListener('contextmenu', this.onMenu, true);\r\n\r\n      document.addEventListener('touchstart', this.onTouchStart, {passive: false, capture: true});\r\n      document.addEventListener('touchmove', this.onTouchMove, {passive: false, capture: true});\r\n      document.addEventListener('touchend', this.onTouchEnd, {passive: false, capture: true});\r\n\r\n      document.addEventListener('pointerlockchange', this.onPointerLockChange);\r\n      document.addEventListener('fullscreenchange', this.onFullscreenChange);\r\n      window.addEventListener('resize', this.onResize);\r\n\r\n      this.setState({started: true});\r\n    }, e => this.onError(e.message));\r\n  }\r\n\r\n  pointerLocked() {\r\n    return document.pointerLockElement === this.canvas || document.mozPointerLockElement === this.canvas;\r\n  }\r\n\r\n  mousePos(e) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    if (this.pointerLocked()) {\r\n      this.cursorPos.x = Math.max(rect.left, Math.min(rect.right, this.cursorPos.x + e.movementX));\r\n      this.cursorPos.y = Math.max(rect.top, Math.min(rect.bottom, this.cursorPos.y + e.movementY));\r\n    } else {\r\n      this.cursorPos = {x: e.clientX, y: e.clientY};\r\n    }\r\n    return {\r\n      x: Math.max(0, Math.min(Math.round((this.cursorPos.x - rect.left) / (rect.right - rect.left) * 640), 639)),\r\n      y: Math.max(0, Math.min(Math.round((this.cursorPos.y - rect.top) / (rect.bottom - rect.top) * 480), 479)),\r\n    };\r\n  }\r\n\r\n  mouseButton(e) {\r\n    switch (e.button) {\r\n    case 0: return 1;\r\n    case 1: return 4;\r\n    case 2: return 2;\r\n    case 3: return 5;\r\n    case 4: return 6;\r\n    default: return 1;\r\n    }\r\n  }\r\n  eventMods(e) {\r\n    return ((e.shiftKey || this.touchMods[TOUCH_SHIFT]) ? 1 : 0) + (e.ctrlKey ? 2 : 0) + (e.altKey ? 4 : 0) + (e.touches ? 8 : 0);\r\n  }\r\n\r\n  onResize = () => {\r\n    document.exitPointerLock();\r\n  }\r\n\r\n  onPointerLockChange = () => {\r\n    if (window.screen && window.innerHeight === window.screen.height && !this.pointerLocked()) {\r\n      // assume that the user pressed escape\r\n      this.game(\"DApi_Key\", 0, 0, 27);\r\n      this.game(\"DApi_Key\", 1, 0, 27);\r\n    }\r\n  }\r\n\r\n  onMouseMove = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseDown = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    if (window.screen && window.innerHeight === window.screen.height) {\r\n      // we're in fullscreen, let's get pointer lock!\r\n      if (!this.pointerLocked()) {\r\n        this.canvas.requestPointerLock();\r\n      }\r\n    }\r\n    this.game(\"DApi_Mouse\", 1, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseUp = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 2, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyDown = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 0, this.eventMods(e), e.keyCode);\r\n    if (e.keyCode >= 32 && e.key.length === 1) {\r\n      this.game(\"DApi_Char\", e.key.charCodeAt(0));\r\n    }\r\n  }\r\n\r\n  onMenu = e => {\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyUp = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 1, this.eventMods(e), e.keyCode);\r\n    const text = this.keyboard.value;\r\n    const values = [...Array(15)].map((_, i) => i < text.length ? text.charCodeAt(i) : 0);\r\n    this.game(\"DApi_SyncText\", ...values);\r\n  }\r\n\r\n  parseFile = e => {\r\n    const files = e.target.files;\r\n    if (files.length > 0) {\r\n      this.start(files[0]);\r\n    }\r\n  }\r\n\r\n  touchButton = null;\r\n  touchCanvas = null;\r\n\r\n  onFullscreenChange = () => {\r\n    this.setState({touch: (document.fullscreenElement === this.element)});\r\n  }\r\n\r\n  setTouchMod(index, value, use) {\r\n    if (index < 3) {\r\n      this.touchMods[index] = value;\r\n      if (this.touchButtons[index]) {\r\n        this.touchButtons[index].classList.toggle(\"active\", value);\r\n      }\r\n    } else if (use && this.touchBelt[index] >= 0) {\r\n      const now = performance.now();\r\n      if (!this.beltTime || now - this.beltTime > 750) {\r\n        this.game(\"DApi_Char\", 49 + this.touchBelt[index]);\r\n        this.beltTime = now;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateTouchButton(touches, release) {\r\n    let touchOther = null;\r\n    const btn = this.touchButton;\r\n    for (let {target, identifier, clientX, clientY} of touches) {\r\n      if (btn && btn.id === identifier && this.touchButtons[btn.index] === target) {\r\n        if (touches.length > 1) {\r\n          btn.stick = false;\r\n        }\r\n        btn.clientX = clientX;\r\n        btn.clientY = clientY;\r\n        this.touchCanvas = [...touches].find(t => t.identifier !== identifier);\r\n        if (this.touchCanvas) {\r\n          this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n        }\r\n        delete this.panPos;\r\n        return this.touchCanvas != null;\r\n      }\r\n      const idx = this.touchButtons.indexOf(target);\r\n      if (idx >= 0 && !touchOther) {\r\n        touchOther = {id: identifier, index: idx, stick: true, original: this.touchMods[idx], clientX, clientY};\r\n      }\r\n    }\r\n    if (btn && !touchOther && release && btn.stick) {\r\n      const rect = this.touchButtons[btn.index].getBoundingClientRect();\r\n      const {clientX, clientY} = btn;\r\n      if (clientX >= rect.left && clientX < rect.right && clientY >= rect.top && clientY < rect.bottom) {\r\n        this.setTouchMod(btn.index, !btn.original, true);\r\n      } else {\r\n        this.setTouchMod(btn.index, btn.original);\r\n      }\r\n    } else if (btn) {\r\n      this.setTouchMod(btn.index, false);\r\n    }\r\n    this.touchButton = touchOther;\r\n    if (touchOther) {\r\n      this.setTouchMod(touchOther.index, true);\r\n      if (touchOther.index === TOUCH_MOVE) {\r\n        this.setTouchMod(TOUCH_RMB, false);\r\n      } else if (touchOther.index === TOUCH_RMB) {\r\n        this.setTouchMod(TOUCH_MOVE, false);\r\n      }\r\n      delete this.panPos;\r\n    } else if (touches.length === 2) {\r\n      const x = (touches[1].clientX + touches[0].clientX) / 2, y = (touches[1].clientY + touches[0].clientY) / 2;\r\n      if (this.panPos) {\r\n        const dx = x - this.panPos.x, dy = y - this.panPos.y;\r\n        const step = this.canvas.offsetHeight / 12;\r\n        if (Math.max(Math.abs(dx), Math.abs(dy)) > step) {\r\n          let key;\r\n          if (Math.abs(dx) > Math.abs(dy)) {\r\n            key = (dx > 0 ? 0x25 : 0x27);\r\n          } else {\r\n            key = (dy > 0 ? 0x26 : 0x28);\r\n          }\r\n          this.game(\"DApi_Key\", 0, 0, key);\r\n          // key up is ignored anyway\r\n          this.panPos = {x, y};\r\n        }\r\n      } else {\r\n        this.game(\"DApi_Mouse\", 0, 0, 24, 320, 180);\r\n        this.game(\"DApi_Mouse\", 2, 1, 24, 320, 180);\r\n        this.panPos = {x, y};\r\n      }\r\n      this.touchCanvas = null;\r\n      return false;\r\n    } else {\r\n      delete this.panPos;\r\n    }\r\n    this.touchCanvas = [...touches].find(t => !touchOther || t.identifier !== touchOther.id);\r\n    if (this.touchCanvas) {\r\n      this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n    }\r\n    return this.touchCanvas != null;\r\n  }\r\n\r\n  onTouchStart = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n      if (!this.touchMods[TOUCH_MOVE]) {\r\n        this.game(\"DApi_Mouse\", 1, this.touchMods[TOUCH_RMB] ? 2 : 1, this.eventMods(e), x, y);\r\n      }\r\n    }\r\n  }\r\n  onTouchMove = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    }\r\n  }\r\n  onTouchEnd = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    const prevTc = this.touchCanvas;\r\n    this.updateTouchButton(e.touches, true);\r\n    if (prevTc && !this.touchCanvas) {\r\n      const {x, y} = this.mousePos(prevTc);\r\n      this.game(\"DApi_Mouse\", 2, 1, this.eventMods(e), x, y);\r\n      this.game(\"DApi_Mouse\", 2, 2, this.eventMods(e), x, y);\r\n\r\n      if (this.touchMods[TOUCH_RMB] && (!this.touchButton || this.touchButton.index !== TOUCH_RMB)) {\r\n        this.setTouchButton(TOUCH_RMB, false);\r\n      }\r\n    }\r\n    if (!document.fullscreenElement) {\r\n      this.element.requestFullscreen();\r\n    }\r\n  }\r\n\r\n  setCanvas = e => this.canvas = e;\r\n  setElement = e => this.element = e;\r\n  setKeyboard = e => this.keyboard = e;\r\n  setTouch_(i, e) {\r\n    this.touchButtons[i] = e;\r\n  }\r\n  setTouchBelt_(i, e) {\r\n    this.touchButtons[i] = e;\r\n    if (e) {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = 28;\r\n      canvas.height = 28;\r\n      e.appendChild(canvas);\r\n      this.touchCtx[i] = canvas.getContext(\"2d\");\r\n    } else {\r\n      this.touchCtx[i] = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {started, loading, error, progress, dropping, touch, has_spawn} = this.state;\r\n    return (\r\n      <div className={classNames(\"App\", {touch, started, dropping})} ref={this.setElement}>\r\n        <div className=\"touch-ui touch-mods\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\", {active: this.touchMods[0]})} ref={this.setTouch0}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\", {active: this.touchMods[1]})} ref={this.setTouch1}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\", {active: this.touchMods[2]})} ref={this.setTouch2}/>\r\n        </div>\r\n        <div className=\"touch-ui touch-belt\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\")} ref={this.setTouch3}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\")} ref={this.setTouch4}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\")} ref={this.setTouch5}/>\r\n        </div>\r\n        <div className=\"Body\">\r\n          {!error && (\r\n            <canvas ref={this.setCanvas} width={640} height={480}/>\r\n          )}\r\n        </div>\r\n        <div className=\"BodyV\">\r\n          <input type=\"text\" className=\"keyboard\" ref={this.setKeyboard}/>\r\n          {!!error && (\r\n            <div className=\"error\">{error}</div>\r\n          )}\r\n          {!!loading && !started && !error && (\r\n            <div className=\"loading\">\r\n              {progress && progress.text || 'Loading...'}\r\n              {progress != null && !!progress.total && (\r\n                <span className=\"progressBar\"><span><span style={{width: `${Math.round(100 * progress.loaded / progress.total)}%`}}/></span></span>\r\n              )}\r\n            </div>\r\n          )}\r\n          {!started && !loading && !error && (\r\n            <div className=\"start\">\r\n              <p>\r\n                This is a web port of the original Diablo game, based on source code reconstructed by\r\n                GalaXyHaXz and devilution team: <Link href=\"https://github.com/diasurgical/devilution\">https://github.com/diasurgical/devilution</Link>\r\n              </p>\r\n              <p>\r\n                If you own the original game, you can drop the original DIABDAT.MPQ onto this page or click the button below to start playing.\r\n                The game can be purchased from <Link href=\"https://www.gog.com/game/diablo\">GoG</Link>.\r\n              </p>\r\n              {!has_spawn && (\r\n                <p>\r\n                  Or you can play the shareware version for free (50MB download).\r\n                </p>\r\n              )}\r\n              <form>\r\n                <label htmlFor=\"loadFile\" className=\"startButton\">Select MPQ</label>\r\n                <input accept=\".mpq\" type=\"file\" id=\"loadFile\" style={{display: \"none\"}} onChange={this.parseFile}/>\r\n              </form>\r\n              <span className=\"startButton\" onClick={() => this.start()}>Play Shareware</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './reset.css';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport App from './App';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\nserviceWorker.register();\r\n","import IdbKvStore from  'idb-kv-store';\r\n\r\nexport default async function create_fs() {\r\n  try {\r\n    const store = new IdbKvStore('diablo_fs');\r\n    const files = new Map();\r\n    for (let [name, data] of Object.entries(await store.json())) {\r\n      files.set(name, data);\r\n    }\r\n    return {\r\n      files,\r\n      update: (name, data) => store.set(name, data),\r\n      delete: name => store.remove(name),\r\n    };\r\n  } catch (e) {\r\n    return {\r\n      files: new Map(),\r\n      update: () => Promise.resolve(),\r\n      delete: () => Promise.resolve(),\r\n    };\r\n  }  \r\n}\r\n"],"sourceRoot":""}